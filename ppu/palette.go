package ppu

import "image/color"

var colors = map[uint8]color.RGBA{
	0x00: {R: 0x75, G: 0x75, B: 0x75},
	0x01: {R: 0x27, G: 0x1B, B: 0x8F},
	0x02: {R: 0x00, G: 0x00, B: 0xAB},
	0x03: {R: 0x47, G: 0x00, B: 0x9F},
	0x04: {R: 0x8F, G: 0x00, B: 0x77},
	0x05: {R: 0xAB, G: 0x00, B: 0x13},
	0x06: {R: 0xA7, G: 0x00, B: 0x00},
	0x07: {R: 0x7F, G: 0x0B, B: 0x00},
	0x08: {R: 0x43, G: 0x2F, B: 0x00},
	0x09: {R: 0x00, G: 0x47, B: 0x00},
	0x0A: {R: 0x00, G: 0x51, B: 0x00},
	0x0B: {R: 0x00, G: 0x3F, B: 0x17},
	0x0C: {R: 0x1B, G: 0x3F, B: 0x5F},
	0x0D: {R: 0x00, G: 0x00, B: 0x00},
	0x0E: {R: 0x00, G: 0x00, B: 0x00},
	0x0F: {R: 0x00, G: 0x00, B: 0x00},
	0x10: {R: 0xBC, G: 0xBC, B: 0xBC},
	0x11: {R: 0x00, G: 0x73, B: 0xEF},
	0x12: {R: 0x23, G: 0x3B, B: 0xEF},
	0x13: {R: 0x83, G: 0x00, B: 0xF3},
	0x14: {R: 0xBF, G: 0x00, B: 0xBF},
	0x15: {R: 0xE7, G: 0x00, B: 0x5B},
	0x16: {R: 0xDB, G: 0x2B, B: 0x00},
	0x17: {R: 0xCB, G: 0x4F, B: 0x0F},
	0x18: {R: 0x8B, G: 0x73, B: 0x00},
	0x19: {R: 0x00, G: 0x97, B: 0x00},
	0x1A: {R: 0x00, G: 0xAB, B: 0x00},
	0x1B: {R: 0x00, G: 0x93, B: 0x3B},
	0x1C: {R: 0x00, G: 0x83, B: 0x8B},
	0x1D: {R: 0x00, G: 0x00, B: 0x00},
	0x1E: {R: 0x00, G: 0x00, B: 0x00},
	0x1F: {R: 0x00, G: 0x00, B: 0x00},
	0x20: {R: 0xFF, G: 0xFF, B: 0xFF},
	0x21: {R: 0x3F, G: 0xBF, B: 0xFF},
	0x22: {R: 0x5F, G: 0x97, B: 0xFF},
	0x23: {R: 0xA7, G: 0x8B, B: 0xFD},
	0x24: {R: 0xF7, G: 0x7B, B: 0xFF},
	0x25: {R: 0xFF, G: 0x77, B: 0xB7},
	0x26: {R: 0xFF, G: 0x77, B: 0x63},
	0x27: {R: 0xFF, G: 0x9B, B: 0x3B},
	0x28: {R: 0xF3, G: 0xBF, B: 0x3F},
	0x29: {R: 0x83, G: 0xD3, B: 0x13},
	0x2A: {R: 0x4F, G: 0xDF, B: 0x4B},
	0x2B: {R: 0x58, G: 0xF8, B: 0x98},
	0x2C: {R: 0x00, G: 0xEB, B: 0xDB},
	0x2D: {R: 0x00, G: 0x00, B: 0x00},
	0x2E: {R: 0x00, G: 0x00, B: 0x00},
	0x2F: {R: 0x00, G: 0x00, B: 0x00},
	0x30: {R: 0xFF, G: 0xFF, B: 0xFF},
	0x31: {R: 0xAB, G: 0xE7, B: 0xFF},
	0x32: {R: 0xC7, G: 0xD7, B: 0xFF},
	0x33: {R: 0xD7, G: 0xCB, B: 0xFF},
	0x34: {R: 0xFF, G: 0xC7, B: 0xFF},
	0x35: {R: 0xFF, G: 0xC7, B: 0xDB},
	0x36: {R: 0xFF, G: 0xBF, B: 0xB3},
	0x37: {R: 0xFF, G: 0xDB, B: 0xAB},
	0x38: {R: 0xFF, G: 0xE7, B: 0xA3},
	0x39: {R: 0xE3, G: 0xFF, B: 0xA3},
	0x3A: {R: 0xAB, G: 0xF3, B: 0xBF},
	0x3B: {R: 0xB3, G: 0xFF, B: 0xCF},
	0x3C: {R: 0x9F, G: 0xFF, B: 0xF3},
	0x3D: {R: 0x00, G: 0x00, B: 0x00},
	0x3E: {R: 0x00, G: 0x00, B: 0x00},
	0x3F: {R: 0x00, G: 0x00, B: 0x00},
}

type palettes [4][4]color.RGBA

func loadPalettes(paletteMem []uint8) palettes {
	var palettes palettes
	for i, value := range paletteMem {
		palettes.write(uint8(i/4), uint8(i%4), value)
	}
	return palettes
}

func (p *palettes) write(paletteId uint8, colorIdx uint8, colorValue uint8) {
	r, g, b, a := color.Transparent.RGBA()
	color := color.RGBA{R: uint8(r), G: uint8(g), B: uint8(b), A: uint8(a)}
	if colorIdx > 0 || paletteId == 0 {
		color = colors[colorValue]
	}
	(*p)[paletteId][colorIdx] = color
}

func (p *palettes) Read(paletteId uint8, colorIdx uint8) color.RGBA {
	if colorIdx == 0 {
		return (*p)[0][colorIdx]
	}
	return (*p)[paletteId][colorIdx]
}
